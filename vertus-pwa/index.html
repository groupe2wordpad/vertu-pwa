<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="theme-color" content="#1E0433"/>
  <meta name="description" content="Tirez chaque jour une vertu chrÃ©tienne Ã  vivre concrÃ¨tement. Influencons Autrement."/>
  <meta name="apple-mobile-web-app-capable" content="yes"/>
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
  <meta name="apple-mobile-web-app-title" content="Vertu du Jour"/>
  <link rel="manifest" href="manifest.json"/>
  <link rel="apple-touch-icon" href="icons/icon-192.png"/>
  <title>Ma Vertu du Jour â€” Influencons.com</title>
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;0,700;1,300;1,400&family=Cinzel:wght@400;600&display=swap" rel="stylesheet"/>
  <style>
    :root {
      --violet-deep:  #1E0433;
      --violet-mid:   #4A1070;
      --violet-light: #7B2D8B;
      --gold:         #E8C84A;
      --gold-light:   #F5E27A;
      --gold-dark:    #C9A227;
      --white:        #FFFFFF;
      --white-soft:   #F0EBF8;
      --white-dim:    rgba(255,255,255,0.75);
      --white-faint:  rgba(255,255,255,0.28);
      --white-ghost:  rgba(255,255,255,0.10);
    }
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      min-height:100vh;
      background: linear-gradient(160deg, #EFE3E7 0%, #EDE0D4 35%, #F5EFE0 70%, #F9F2E2 100%);
      font-family:'Cormorant Garamond', Georgia, serif;
      color: #2D0650;
      overflow-x: hidden;
    }

    /* Stars */
    .stars { position:fixed; inset:0; pointer-events:none; z-index:0; }
    .star {
      position:absolute; border-radius:50%;
      background: #9B5FB5;
      animation: twinkle var(--d,3s) ease-in-out infinite var(--delay,0s);
      opacity:0;
    }
    @keyframes twinkle {
      0%,100%{opacity:0;transform:scale(.8);}
      50%{opacity:var(--op,.5);transform:scale(1);}
    }
    .orb {
      position:fixed; top:-150px; left:50%; transform:translateX(-50%);
      width:700px; height:700px; border-radius:50%;
      background: radial-gradient(circle, rgba(180,100,200,0.12) 0%, transparent 65%);
      pointer-events:none; z-index:0;
    }

    /* Layout */
    .page {
      position:relative; z-index:1; min-height:100vh;
      display:flex; flex-direction:column; align-items:center;
      padding:32px 20px 60px;
    }

    /* Notification bell */
    .notif-btn {
      position:fixed; top:18px; right:18px; z-index:100;
      width:44px; height:44px; border-radius:50%;
      background: rgba(255,255,255,0.6);
      border:1px solid rgba(123,45,139,0.2);
      display:flex; align-items:center; justify-content:center;
      cursor:pointer; transition:all .25s; backdrop-filter:blur(8px);
    }
    .notif-btn:hover { background:rgba(255,255,255,0.9); border-color:var(--gold); }
    .notif-btn svg { width:20px; height:20px; }
    .notif-btn .dot {
      position:absolute; top:9px; right:9px;
      width:8px; height:8px; border-radius:50%;
      background:var(--gold); border:1.5px solid white;
      display:none;
    }
    .notif-btn.active .dot { display:block; }
    .notif-btn.active svg path { stroke:var(--violet-light); }

    /* Notif modal */
    .modal-overlay {
      position:fixed; inset:0; background:rgba(10,0,20,0.75);
      z-index:200; display:none; align-items:center; justify-content:center;
      backdrop-filter:blur(4px);
    }
    .modal-overlay.open { display:flex; }
    .modal {
      background:linear-gradient(145deg,rgba(74,16,112,0.95),rgba(30,4,51,0.98));
      border:1px solid rgba(232,200,74,0.25);
      border-radius:20px; padding:36px 32px; max-width:360px; width:90%;
      text-align:center; box-shadow:0 30px 80px rgba(0,0,0,0.6);
    }
    .modal h3 {
      font-family:'Cinzel',serif; font-size:.9rem; letter-spacing:3px;
      color:var(--gold); margin-bottom:8px;
    }
    .modal p {
      font-size:.95rem; color:var(--white-dim); line-height:1.6; margin-bottom:24px;
    }
    .time-pick {
      display:flex; align-items:center; justify-content:center; gap:10px;
      margin-bottom:24px;
    }
    .time-pick label {
      font-family:'Cinzel',serif; font-size:.65rem; letter-spacing:2px;
      color:var(--white-dim); display:block; margin-bottom:6px;
    }
    .time-pick select {
      background:rgba(255,255,255,0.08); border:1px solid rgba(255,255,255,0.2);
      color:var(--white); font-family:'Cinzel',serif; font-size:.9rem;
      padding:8px 14px; border-radius:10px; cursor:pointer; outline:none;
    }
    .time-sep { color:var(--gold); font-size:1.4rem; margin-top:16px; }
    .modal-actions { display:flex; gap:10px; justify-content:center; }
    .btn-modal-confirm {
      padding:11px 28px; border-radius:50px;
      background:linear-gradient(135deg,var(--gold-dark),var(--gold),var(--gold-light));
      color:var(--violet-deep); font-family:'Cinzel',serif;
      font-size:.75rem; font-weight:600; letter-spacing:2px;
      border:none; cursor:pointer; transition:transform .2s;
    }
    .btn-modal-confirm:hover { transform:translateY(-1px); }
    .btn-modal-cancel {
      padding:11px 22px; border-radius:50px; background:transparent;
      border:1px solid rgba(255,255,255,0.15); color:var(--white-dim);
      font-family:'Cinzel',serif; font-size:.72rem; letter-spacing:2px;
      cursor:pointer; transition:all .2s;
    }
    .btn-modal-cancel:hover { border-color:rgba(255,255,255,.35); color:var(--white); }
    .notif-status {
      font-size:.78rem; color:var(--gold); letter-spacing:1px;
      margin-top:14px; min-height:20px; font-style:italic;
    }

    /* Header */
    header { text-align:center; margin-bottom:28px; animation:fadeDown .9s ease both; }
    @keyframes fadeDown {
      from{opacity:0;transform:translateY(-20px);}
      to{opacity:1;transform:translateY(0);}
    }
    .logo-circle {
      width:86px; height:86px; margin:0 auto 14px; border-radius:50%;
      background:radial-gradient(circle at 38% 38%,var(--violet-light),var(--violet-deep));
      border:1.5px solid rgba(232,200,74,0.55);
      display:flex; align-items:center; justify-content:center;
      box-shadow:0 0 35px rgba(232,200,74,0.15),inset 0 0 20px rgba(0,0,0,0.3);
    }
    .logo-circle svg { width:44px; height:44px; }
    .site-name {
      font-family:'Cinzel',serif; font-size:1.05rem; font-weight:600;
      letter-spacing:4px; color:#2D0650;
    }
    .site-name span { color:var(--gold-dark); font-weight:400; }
    .tagline {
      font-size:.83rem; letter-spacing:2.5px; color:#6B3080;
      margin-top:5px; font-style:italic;
    }
    .divider {
      display:flex; align-items:center; gap:10px;
      margin:10px auto 0; width:210px;
    }
    .divider-line { flex:1; height:1px; background:linear-gradient(to right,transparent,rgba(232,200,74,.5)); }
    .divider-line.r { background:linear-gradient(to left,transparent,rgba(232,200,74,.5)); }
    .divider-diamond { width:6px; height:6px; background:var(--gold); transform:rotate(45deg); flex-shrink:0; }

    .date-badge {
      font-family:'Cinzel',serif; font-size:.68rem; letter-spacing:3px;
      color:#6B3080; text-transform:uppercase; margin-bottom:28px;
      animation:fadeDown .9s .15s ease both;
    }

    /* Card */
    .card {
      width:100%; max-width:520px;
      background: rgba(255,255,255,0.55);
      border:1px solid rgba(123,45,139,0.15);
      border-radius:24px; padding:42px 38px 38px; text-align:center;
      box-shadow:0 8px 40px rgba(80,20,120,0.1),inset 0 1px 0 rgba(255,255,255,0.8);
      backdrop-filter:blur(12px);
      animation:fadeUp .9s .25s ease both; position:relative; overflow:hidden;
    }
    @keyframes fadeUp {
      from{opacity:0;transform:translateY(28px);}
      to{opacity:1;transform:translateY(0);}
    }
    .card::before,.card::after {
      content:''; position:absolute; width:54px; height:54px;
      border-color:rgba(123,45,139,0.2); border-style:solid;
    }
    .card::before { top:14px;left:14px;border-width:1px 0 0 1px;border-radius:6px 0 0 0; }
    .card::after  { bottom:14px;right:14px;border-width:0 1px 1px 0;border-radius:0 0 6px 0; }

    /* Idle */
    .idle-section { display:flex; flex-direction:column; align-items:center; gap:22px; }
    .idle-icon {
      width:80px; height:80px; border-radius:50%;
      background:radial-gradient(circle,rgba(123,45,139,0.1),transparent 70%);
      border:1px solid rgba(123,45,139,0.2);
      display:flex; align-items:center; justify-content:center;
    }
    .idle-icon svg { width:36px; height:36px; }
    .idle-text {
      font-size:1.1rem; font-weight:300; color:#5A2070;
      line-height:1.75; font-style:italic; max-width:300px;
    }

    /* Result */
    .result-section { display:none; flex-direction:column; align-items:center; gap:20px; }
    .result-section.visible { display:flex; }
    .vertu-label {
      font-family:'Cinzel',serif; font-size:.63rem;
      letter-spacing:4px; color:#7B2D8B; opacity:.8;
    }
    .vertu-name {
      font-family:'Cinzel',serif; font-size:2.2rem; font-weight:600;
      color:#2D0650; line-height:1.15;
      text-shadow:0 2px 20px rgba(123,45,139,0.15);
      animation:glowIn .55s ease both;
    }
    @keyframes glowIn {
      from{opacity:0;transform:scale(.93);}
      to{opacity:1;transform:scale(1);}
    }
    .vertu-def {
      font-size:1.03rem; color:#5A2070;
      font-style:italic; line-height:1.72; max-width:360px;
    }
    .verset-box {
      background:rgba(123,45,139,0.07);
      border-left:2px solid rgba(123,45,139,0.4);
      border-radius:0 12px 12px 0;
      padding:15px 20px; text-align:left; width:100%;
    }
    .verset-text {
      font-size:.98rem; color:#2D0650;
      font-style:italic; line-height:1.65; margin-bottom:7px;
    }
    .verset-ref {
      font-family:'Cinzel',serif; font-size:.62rem;
      color:var(--gold-dark); letter-spacing:2px; opacity:.9;
    }
    .defi-box {
      background:rgba(123,45,139,0.05);
      border:1px solid rgba(123,45,139,0.12);
      border-radius:14px; padding:16px 20px; width:100%; text-align:left;
    }
    .defi-label {
      font-family:'Cinzel',serif; font-size:.6rem;
      letter-spacing:3px; color:var(--gold-dark); opacity:.9;
      margin-bottom:8px; display:flex; align-items:center; gap:8px;
    }
    .defi-label::after { content:''; flex:1; height:1px; background:rgba(123,45,139,0.12); }
    .defi-text { font-size:.97rem; color:#2D0650; line-height:1.62; }

    /* Buttons */
    .btn-draw {
      margin-top:4px; padding:16px 44px; border-radius:50px;
      background:linear-gradient(135deg,var(--gold-dark),var(--gold),var(--gold-light));
      color:var(--violet-deep); font-family:'Cinzel',serif;
      font-size:.88rem; font-weight:600; letter-spacing:3px;
      border:none; cursor:pointer;
      box-shadow:0 8px 30px rgba(232,200,74,0.22),0 2px 8px rgba(0,0,0,0.3);
      transition:transform .2s,box-shadow .2s; position:relative; overflow:hidden;
    }
    .btn-draw::after {
      content:''; position:absolute; inset:0;
      background:linear-gradient(135deg,rgba(255,255,255,0.22),transparent);
      border-radius:inherit;
    }
    .btn-draw:hover { transform:translateY(-2px); box-shadow:0 14px 40px rgba(232,200,74,0.3); }
    .btn-draw:active { transform:translateY(0); }

    .btn-redraw {
      background:transparent; border:1px solid rgba(123,45,139,0.25);
      color:#7B2D8B; font-family:'Cinzel',serif; font-size:.72rem;
      letter-spacing:2.5px; padding:10px 28px; border-radius:50px;
      cursor:pointer; transition:all .2s; margin-top:2px;
    }
    .btn-redraw:hover { background:rgba(123,45,139,0.08); border-color:#7B2D8B; }

    .share-row { display:flex; gap:9px; justify-content:center; flex-wrap:wrap; }
    .btn-share {
      display:flex; align-items:center; gap:7px;
      padding:9px 17px; border-radius:50px;
      border:1px solid rgba(123,45,139,0.18);
      background:rgba(255,255,255,0.5);
      color:#5A2070; font-size:.78rem;
      font-family:'Cormorant Garamond',serif; letter-spacing:1px;
      cursor:pointer; transition:all .2s;
    }
    .btn-share:hover { background:rgba(255,255,255,0.85); color:#2D0650; border-color:rgba(123,45,139,.35); }
    .btn-share svg { width:14px; height:14px; }

    /* Spinner */
    .spinner {
      width:34px; height:34px;
      border:2px solid rgba(123,45,139,0.15);
      border-top-color:#7B2D8B; border-radius:50%;
      animation:spin .75s linear infinite; display:none; margin:10px auto;
    }
    .spinner.visible { display:block; }
    @keyframes spin { to{transform:rotate(360deg);} }

    /* Progress bar */
    .progress-bar-wrap {
      width:100%; max-width:520px; margin-top:20px;
      animation:fadeUp .9s .4s ease both;
    }
    .progress-label {
      display:flex; justify-content:space-between;
      font-family:'Cinzel',serif; font-size:.6rem; letter-spacing:2px;
      color:#7B2D8B; opacity:.7; margin-bottom:7px;
    }
    .progress-track {
      height:3px; background:rgba(123,45,139,0.12);
      border-radius:10px; overflow:hidden;
    }
    .progress-fill {
      height:100%; background:linear-gradient(to right,var(--gold-dark),var(--gold));
      border-radius:10px; transition:width .6s ease;
    }
    .progress-message {
      margin-top:10px; text-align:center;
      font-family:'Cormorant Garamond', serif; font-size:.95rem;
      font-style:italic; color:#5A2070; min-height:22px;
      animation: fadeIn .6s ease;
    }
    @keyframes fadeIn { from{opacity:0;} to{opacity:1;} }

    /* History */
    .history-section {
      width:100%; max-width:520px; margin-top:22px;
      animation:fadeUp .9s .5s ease both;
    }
    .history-title {
      font-family:'Cinzel',serif; font-size:.62rem;
      letter-spacing:3.5px; color:#7B2D8B; opacity:.5;
      text-align:center; margin-bottom:11px;
    }
    .history-list { display:flex; flex-direction:column; gap:7px; }
    .history-item {
      display:flex; align-items:center; gap:13px;
      background:rgba(255,255,255,0.5);
      border:1px solid rgba(123,45,139,0.1);
      border-radius:12px; padding:11px 17px;
    }
    .history-date {
      font-family:'Cinzel',serif; font-size:.58rem;
      color:var(--gold-dark); opacity:.8; letter-spacing:1px; white-space:nowrap;
    }
    .history-dot { width:4px; height:4px; border-radius:50%; background:#7B2D8B; opacity:.25; flex-shrink:0; }
    .history-name { font-size:.93rem; color:#2D0650; font-weight:600; }

    /* Footer */
    footer {
      margin-top:44px; text-align:center;
      font-size:.72rem; color:rgba(90,32,112,0.4); letter-spacing:1.5px;
      animation:fadeUp .9s .6s ease both;
    }
    footer a { color:var(--gold-dark); opacity:.6; text-decoration:none; }

    @media(max-width:560px){
      .card{padding:32px 20px 28px;}
      .vertu-name{font-size:1.8rem;}
    }

    /* Toast */
    .toast {
      position:fixed; bottom:28px; left:50%; transform:translateX(-50%) translateY(80px);
      background:rgba(45,6,80,0.92); border:1px solid rgba(123,45,139,0.3);
      color:white; font-family:'Cinzel',serif; font-size:.72rem;
      letter-spacing:1.5px; padding:12px 24px; border-radius:50px;
      backdrop-filter:blur(8px); z-index:300;
      transition:transform .35s ease, opacity .35s ease; opacity:0;
    }
    .toast.show { transform:translateX(-50%) translateY(0); opacity:1; }
  </style>
</head>
<body>

<div class="stars" id="stars"></div>
<div class="orb"></div>

<!-- Notification bell -->
<button class="notif-btn" id="notifBtn" onclick="openNotifModal()" title="Rappel quotidien">
  <svg viewBox="0 0 24 24" fill="none" stroke="#4A1070" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
    <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/>
    <path d="M13.73 21a2 2 0 0 1-3.46 0"/>
  </svg>
  <span class="dot"></span>
</button>

<!-- Notification modal -->
<div class="modal-overlay" id="notifModal">
  <div class="modal">
    <h3>ðŸ”” RAPPEL QUOTIDIEN</h3>
    <p>Recevez chaque jour une notification pour tirer votre vertu et rester dans l'esprit du CarÃªme.</p>
    <div class="time-pick">
      <div>
        <label>Heure</label>
        <select id="notifHour">
          <option value="6">06</option><option value="7">07</option>
          <option value="8" selected>08</option><option value="9">09</option>
          <option value="10">10</option><option value="12">12</option>
          <option value="18">18</option><option value="20">20</option>
          <option value="21">21</option>
        </select>
      </div>
      <span class="time-sep">:</span>
      <div>
        <label>Minute</label>
        <select id="notifMinute">
          <option value="0" selected>00</option>
          <option value="15">15</option>
          <option value="30">30</option>
          <option value="45">45</option>
        </select>
      </div>
    </div>
    <div class="modal-actions">
      <button class="btn-modal-cancel" onclick="closeNotifModal()">Annuler</button>
      <button class="btn-modal-confirm" onclick="activerNotifications()">âœ¦ Activer</button>
    </div>
    <div class="notif-status" id="notifStatus"></div>
  </div>
</div>

<div class="page">

  <header>
    <div class="logo-circle">
      <svg viewBox="0 0 256 256" xmlns="http://www.w3.org/2000/svg">
        <defs>
          <linearGradient id="fg" x1="128" y1="24" x2="128" y2="200" gradientUnits="userSpaceOnUse">
            <stop offset="0%" stop-color="#F9EFA0"/>
            <stop offset="55%" stop-color="#E8C84A"/>
            <stop offset="100%" stop-color="#C9A227"/>
          </linearGradient>
        </defs>
        <path d="M128,24C108,24 72,52 72,102C72,120 80,136 90,148C86,136 88,120 98,112C94,126 100,142 114,152C108,138 114,120 128,110C122,126 128,144 142,154C152,162 158,176 152,194C166,184 174,164 168,142C176,156 176,174 166,192C180,178 188,156 182,130C186,144 186,162 176,178C190,160 194,138 186,112C178,88 160,68 140,54C148,76 144,102 128,118C132,96 124,72 108,56C116,74 116,96 102,114C94,92 100,58 128,24Z" fill="url(#fg)"/>
        <path d="M128,76C118,88 114,104 120,118C124,106 132,98 140,96C136,108 136,124 126,134C118,122 114,106 120,96C112,106 108,120 114,134C118,146 126,154 128,158C130,154 138,146 142,134C148,120 144,106 136,96C140,108 140,124 130,134C126,120 126,102 128,76Z" fill="rgba(255,255,255,0.28)"/>
      </svg>
    </div>
    <div class="site-name">INFLUENCONS<span>.COM</span></div>
    <div class="tagline">Influencons Autrement</div>
    <div class="divider">
      <div class="divider-line"></div>
      <div class="divider-diamond"></div>
      <div class="divider-line r"></div>
    </div>
  </header>

  <div class="date-badge" id="dateBadge"></div>

  <div class="card">
    <div class="idle-section" id="idleSection">
      <div class="idle-icon">
        <svg viewBox="0 0 24 24" fill="none">
          <path d="M12 2L9.5 8.5H3L8.3 12.5L6.2 19L12 15.3L17.8 19L15.7 12.5L21 8.5H14.5L12 2Z"
            stroke="#7B2D8B" stroke-width="1.2" stroke-linejoin="round" fill="rgba(123,45,139,0.07)"/>
        </svg>
      </div>
      <p class="idle-text">Â« Chaque jour est une nouvelle occasion d'Ãªtre lumiÃ¨re dans le monde. Â»</p>
      <button class="btn-draw" onclick="tirerVertu()">âœ¦ &nbsp;TIRER MA VERTU &nbsp;âœ¦</button>
    </div>

    <div class="spinner" id="spinner"></div>

    <div class="result-section" id="resultSection">
      <div class="vertu-label">âœ¦ &nbsp;VOTRE VERTU DU JOUR &nbsp;âœ¦</div>
      <div class="vertu-name" id="vertuName"></div>
      <p class="vertu-def" id="vertuDef"></p>
      <div class="verset-box">
        <p class="verset-text" id="versetText"></p>
        <p class="verset-ref" id="versetRef"></p>
      </div>
      <div class="defi-box">
        <div class="defi-label">DÃ‰FI DU JOUR</div>
        <p class="defi-text" id="defiText"></p>
      </div>
      <div class="share-row">
        <button class="btn-share" onclick="partager('facebook')">
          <svg viewBox="0 0 24 24" fill="currentColor"><path d="M18 2h-3a5 5 0 00-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 011-1h3z"/></svg>
          Facebook
        </button>
        <button class="btn-share" onclick="partager('whatsapp')">
          <svg viewBox="0 0 24 24" fill="currentColor"><path d="M21 11.5a8.38 8.38 0 01-.9 3.8 8.5 8.5 0 01-7.6 4.7 8.38 8.38 0 01-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 01-.9-3.8 8.5 8.5 0 014.7-7.6 8.38 8.38 0 013.8-.9h.5a8.48 8.48 0 018 8v.5z"/></svg>
          WhatsApp
        </button>
        <button class="btn-share" id="btnCopier" onclick="copier()">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/></svg>
          Copier
        </button>
      </div>
      <button class="btn-redraw" onclick="nouvelleVertu()">â†» &nbsp;Nouvelle vertu</button>
    </div>
  </div>

  <!-- Progress CarÃªme -->
  <div class="progress-bar-wrap" id="progressWrap">
    <div class="progress-label">
      <span>CARÃŠME â€” JOUR <span id="jourNum">?</span> / 40</span>
      <span id="jourRestant">? jours restants</span>
    </div>
    <div class="progress-track">
      <div class="progress-fill" id="progressFill" style="width:0%"></div>
    </div>
    <div class="progress-message" id="progressMessage"></div>
  </div>

  <div class="history-section" id="historySection" style="display:none">
    <div class="history-title">â€” VERTUS PRÃ‰CÃ‰DENTES â€”</div>
    <div class="history-list" id="historyList"></div>
  </div>

  <footer>
    <p>Â© 2025 <a href="https://influencons.com">influencons.com</a> &nbsp;Â·&nbsp; Ma Vertu du Jour &nbsp;Â·&nbsp; CarÃªme</p>
  </footer>
</div>

<div class="toast" id="toast"></div>

<script>
// â”€â”€ 40 VERTUS â”€â”€
const VERTUS = [
  { nom:"La Patience", def:"Accueillir les dÃ©lais et les Ã©preuves avec paix, sans se laisser consumer par l'impatience.", verset:"Â« Soyez patients, mes frÃ¨res, jusqu'Ã  l'avÃ¨nement du Seigneur. Â»", ref:"Jacques 5,7", defi:"Lorsqu'une situation vous contrarie aujourd'hui, prenez 3 respirations profondes avant de rÃ©pondre. Offrez cette patience Ã  Dieu." },
  { nom:"La GÃ©nÃ©rositÃ©", def:"Donner librement de son temps, de ses biens et de son cÅ“ur sans attendre de retour.", verset:"Â« Que chacun donne comme il l'a rÃ©solu en son cÅ“ur, car Dieu aime celui qui donne avec joie. Â»", ref:"2 Corinthiens 9,7", defi:"Faites un geste concret de gÃ©nÃ©rositÃ© aujourd'hui : un sourire, un repas partagÃ©, un service rendu Ã  quelqu'un dans le besoin." },
  { nom:"Le Pardon", def:"LibÃ©rer son cÅ“ur de toute rancÅ“ur et tendre la main Ã  celui qui nous a blessÃ©s.", verset:"Â« Pardonnez-vous les uns les autres, comme Dieu vous a pardonnÃ© en Christ. Â»", ref:"Ã‰phÃ©siens 4,32", defi:"Pensez Ã  quelqu'un envers qui vous portez une blessure. Priez pour cette personne aujourd'hui, mÃªme si c'est difficile." },
  { nom:"L'HumilitÃ©", def:"ReconnaÃ®tre ses limites avec vÃ©ritÃ© et placer la gloire non en soi-mÃªme, mais en Dieu.", verset:"Â« Dieu rÃ©siste aux orgueilleux, mais il fait grÃ¢ce aux humbles. Â»", ref:"Jacques 4,6", defi:"Rendez gloire Ã  Dieu pour un succÃ¨s rÃ©cent plutÃ´t que de vous l'attribuer. Dites 'Merci Seigneur' Ã  voix haute." },
  { nom:"La Gratitude", def:"ReconnaÃ®tre chaque jour les dons reÃ§us et les accueillir avec un cÅ“ur reconnaissant.", verset:"Â« En toutes choses rendez grÃ¢ces, car c'est Ã  votre Ã©gard la volontÃ© de Dieu en JÃ©sus-Christ. Â»", ref:"1 Thessaloniciens 5,18", defi:"Ã‰crivez ce soir 5 choses pour lesquelles vous Ãªtes reconnaissant. Rien n'est trop petit pour remercier Dieu." },
  { nom:"La MisÃ©ricorde", def:"Tendre le cÅ“ur vers ceux qui souffrent et agir avec compassion sans jugement.", verset:"Â« Bienheureux les misÃ©ricordieux, car ils obtiendront misÃ©ricorde. Â»", ref:"Matthieu 5,7", defi:"Y a-t-il une personne en souffrance dans votre entourage ? Contactez-la aujourd'hui avec un mot doux." },
  { nom:"La Douceur", def:"Aborder les autres et les situations avec calme, bienveillance et tendresse.", verset:"Â« Que votre douceur soit connue de tous les hommes. Â»", ref:"Philippiens 4,5", defi:"RÃ©pondez avec douceur lÃ  oÃ¹ vous seriez tentÃ© d'Ãªtre brusque. Observez l'effet sur ceux qui vous entourent." },
  { nom:"La Foi", def:"S'appuyer sur Dieu avec confiance totale, mÃªme lorsque l'on ne voit pas le chemin.", verset:"Â« La foi, c'est la substance des choses qu'on espÃ¨re, et la dÃ©monstration de celles qu'on ne voit pas. Â»", ref:"HÃ©breux 11,1", defi:"Confiez Ã  Dieu une situation qui vous inquiÃ¨te. Ã‰crivez-la sur un papier, priez dessus, puis dÃ©posez-le dans votre Bible." },
  { nom:"La CharitÃ©", def:"Aimer le prochain d'un amour dÃ©sintÃ©ressÃ©, Ã  l'image de l'amour de Dieu pour nous.", verset:"Â« La charitÃ© est patiente, la charitÃ© est bonneâ€¦ elle ne cherche pas son intÃ©rÃªt. Â»", ref:"1 Corinthiens 13,4-5", defi:"Faites un acte d'amour anonyme aujourd'hui. Laissez un encouragement sans signer, ou aidez quelqu'un discrÃ¨tement." },
  { nom:"La TempÃ©rance", def:"MaÃ®triser ses dÃ©sirs et ses appÃ©tits pour vivre avec Ã©quilibre et libertÃ© intÃ©rieure.", verset:"Â« Celui qui se domine vaut mieux que celui qui prend des villes. Â»", ref:"Proverbes 16,32", defi:"Renoncez aujourd'hui Ã  une chose superflue (excÃ¨s d'Ã©cran, nourriture, distraction) et offrez ce renoncement Ã  Dieu." },
  { nom:"La Prudence", def:"Discerner avec sagesse le juste chemin avant d'agir, en cherchant la volontÃ© de Dieu.", verset:"Â« Confie au Seigneur tes Å“uvres, et tes projets rÃ©ussiront. Â»", ref:"Proverbes 16,3", defi:"Avant une dÃ©cision importante aujourd'hui, prenez 5 minutes en silence pour prier et Ã©couter Dieu." },
  { nom:"La Justice", def:"Donner Ã  chacun ce qui lui revient et dÃ©fendre le droit des plus fragiles.", verset:"Â« Recherchez la justice, corrigez l'oppression, dÃ©fendez l'orphelin. Â»", ref:"IsaÃ¯e 1,17", defi:"Prenez position pour quelqu'un traitÃ© injustement. Un mot d'encouragement peut suffire Ã  changer sa journÃ©e." },
  { nom:"L'EspÃ©rance", def:"Garder les yeux fixÃ©s sur les promesses de Dieu, mÃªme au cÅ“ur de l'Ã©preuve.", verset:"Â« Que le Dieu de l'espÃ©rance vous remplisse de toute joie et paix dans la foi. Â»", ref:"Romains 15,13", defi:"Partagez un mot d'espÃ©rance avec quelqu'un qui traverse une pÃ©riode difficile. Soyez la lumiÃ¨re dans sa nuit." },
  { nom:"La PriÃ¨re", def:"Entrer en communion intime avec Dieu, lui confier tout et rester Ã  son Ã©coute.", verset:"Â« Priez sans cesse, rendez grÃ¢ces en toutes choses. Â»", ref:"1 Thessaloniciens 5,17-18", defi:"Consacrez 10 minutes supplÃ©mentaires Ã  la priÃ¨re aujourd'hui. Posez votre tÃ©lÃ©phone et parlez Ã  Dieu Ã  cÅ“ur ouvert." },
  { nom:"Le Service", def:"Se mettre au service des autres avec joie, Ã  l'image du Christ qui est venu pour servir.", verset:"Â« Que le plus grand parmi vous soit votre serviteur. Â»", ref:"Matthieu 23,11", defi:"Proposez votre aide spontanÃ©ment Ã  quelqu'un aujourd'hui â€” sans attendre qu'on vous le demande." },
  { nom:"La PersÃ©vÃ©rance", def:"Tenir ferme dans la foi et l'amour, mÃªme lorsque la fatigue ou le dÃ©couragement s'installent.", verset:"Â« Courons avec persÃ©vÃ©rance dans la carriÃ¨re qui nous est ouverte. Â»", ref:"HÃ©breux 12,1", defi:"Reprenez aujourd'hui une bonne habitude abandonnÃ©e. Un seul pas suffit pour recommencer." },
  { nom:"La SimplicitÃ©", def:"Vivre avec un cÅ“ur droit, sans artifice, en cherchant l'essentiel plutÃ´t que le superflu.", verset:"Â« Cherchez premiÃ¨rement le royaume et la justice de Dieu ; et toutes ces choses vous seront donnÃ©es. Â»", ref:"Matthieu 6,33", defi:"Simplifiez quelque chose aujourd'hui : votre repas, votre planning, votre discours. Retrouvez la beautÃ© de l'essentiel." },
  { nom:"La Compassion", def:"Ressentir la souffrance de l'autre dans ses propres entrailles et agir pour la soulager.", verset:"Â« RevÃªtez-vous donc, comme des Ã©lus de Dieu, de compassion, de bontÃ©, d'humilitÃ©. Â»", ref:"Colossiens 3,12", defi:"Regardez autour de vous avec des yeux neufs. Qui autour de vous a besoin d'Ãªtre vu et reconnu aujourd'hui ?" },
  { nom:"La LoyautÃ©", def:"Rester fidÃ¨le Ã  sa parole, Ã  ses engagements et aux personnes que Dieu a mises sur notre chemin.", verset:"Â« Que votre parole soit oui, oui, non, non. Â»", ref:"Matthieu 5,37", defi:"Honorez un engagement que vous avez tardÃ© Ã  tenir. La fidÃ©litÃ© dans les petites choses construit la confiance." },
  { nom:"Le Courage", def:"Avancer malgrÃ© la peur, porter la vÃ©ritÃ© et dÃ©fendre le bien mÃªme quand c'est difficile.", verset:"Â« Sois fort et courageux. Ne t'effraie point et ne t'Ã©pouvante point, car l'Ã‰ternel ton Dieu est avec toi. Â»", ref:"JosuÃ© 1,9", defi:"Dites une vÃ©ritÃ© difficile avec amour Ã  quelqu'un qui en a besoin, ou affrontez une situation que vous repoussez." },
  { nom:"La SobriÃ©tÃ©", def:"Vivre dans la modÃ©ration et refuser l'excÃ¨s, pour garder un esprit libre et un cÅ“ur disponible Ã  Dieu.", verset:"Â« Soyez sobres, et veillez. Votre adversaire, le diable, rÃ´de comme un lion rugissant. Â»", ref:"1 Pierre 5,8", defi:"Choisissez un repas simple aujourd'hui. Vivez-le comme un acte spirituel conscient, en remerciant Dieu pour chaque bouchÃ©e." },
  { nom:"L'Ã‰coute", def:"Donner Ã  l'autre l'espace d'Ãªtre entendu vraiment, sans interrompre ni juger, avec un cÅ“ur ouvert.", verset:"Â« Que tout homme soit prompt Ã  Ã©couter, lent Ã  parler, lent Ã  se mettre en colÃ¨re. Â»", ref:"Jacques 1,19", defi:"Aujourd'hui, lors d'une conversation, concentrez-vous Ã  100% sur l'autre. Ne pensez pas Ã  votre rÃ©ponse. Ã‰coutez." },
  { nom:"La Paix", def:"Cultiver la sÃ©rÃ©nitÃ© intÃ©rieure qui vient de Dieu et la rayonner autour de soi en toutes circonstances.", verset:"Â« Je vous laisse la paix, je vous donne ma paix. Je ne vous la donne pas comme le monde la donne. Â»", ref:"Jean 14,27", defi:"Identifiez une source d'agitation dans votre vie. Priez pour remettre cela entre les mains de Dieu et choisissez la paix." },
  { nom:"La Joie", def:"Porter en soi une joie profonde qui ne dÃ©pend pas des circonstances, mais de la prÃ©sence de Dieu.", verset:"Â« RÃ©jouissez-vous toujours dans le Seigneur ! Je le dis encore : rÃ©jouissez-vous ! Â»", ref:"Philippiens 4,4", defi:"Cherchez et nommez 3 motifs de joie aujourd'hui, mÃªme dans les petites choses. Partagez cette joie avec quelqu'un." },
  { nom:"La PuretÃ©", def:"Garder son cÅ“ur, ses pensÃ©es et ses actes alignÃ©s avec la saintetÃ© de Dieu.", verset:"Â« Bienheureux ceux qui ont le cÅ“ur pur, car ils verront Dieu. Â»", ref:"Matthieu 5,8", defi:"Examinez vos pensÃ©es d'aujourd'hui. Celles qui sont nÃ©gatives ou impures, confiez-les Ã  Dieu et demandez-Lui un cÅ“ur renouvelÃ©." },
  { nom:"Le ZÃ¨le", def:"S'engager avec ardeur et enthousiasme pour la gloire de Dieu et le bien du prochain.", verset:"Â« Ayez du zÃ¨le, et non de la paresse. Soyez fervents d'esprit. Servez le Seigneur. Â»", ref:"Romains 12,11", defi:"Faites une tÃ¢che ordinaire aujourd'hui avec une excellence extraordinaire, comme si vous la faisiez pour Dieu lui-mÃªme." },
  { nom:"La Confiance", def:"S'abandonner Ã  Dieu avec un cÅ“ur d'enfant, sachant qu'Il tient notre vie entre ses mains.", verset:"Â« Confie-toi en l'Ã‰ternel de tout ton cÅ“ur, et ne t'appuie pas sur ta sagesse. Â»", ref:"Proverbes 3,5", defi:"LÃ¢chez prise sur quelque chose que vous contrÃ´lez trop. Dites Ã  Dieu : 'Je te fais confiance pour cela.' Et laissez faire." },
  { nom:"La Rectitude", def:"Agir avec droiture, intÃ©gritÃ© et transparence, que quelqu'un nous observe ou non.", verset:"Â« Que votre lumiÃ¨re luise ainsi devant les hommes, afin qu'ils voient vos bonnes Å“uvres. Â»", ref:"Matthieu 5,16", defi:"Agissez aujourd'hui de maniÃ¨re irrÃ©prochable dans un domaine oÃ¹ vous pourriez tricher ou prendre un raccourci." },
  { nom:"La BontÃ©", def:"RÃ©pandre autour de soi une chaleur sincÃ¨re et bienveillante, qui reflÃ¨te la bontÃ© mÃªme de Dieu.", verset:"Â« Le fruit de l'Esprit est amour, joie, paix, bontÃ©, douceurâ€¦ Â»", ref:"Galates 5,22", defi:"Faites quelque chose de bon pour quelqu'un qui ne peut rien vous donner en retour. Un inconnu, un voisin, un oubliÃ©." },
  { nom:"Le Partage", def:"Ouvrir ses mains et son cÅ“ur pour que ce qu'on a reÃ§u de Dieu circule vers ceux qui en ont besoin.", verset:"Â« Communiquez Ã  ceux qui sont dans le besoin. Pratiquez l'hospitalitÃ©. Â»", ref:"Romains 12,13", defi:"Partagez quelque chose aujourd'hui : un repas, un savoir, du temps, un vÃªtement. Donnez ce que vous avez en abondance." },
  { nom:"Le Silence", def:"Faire taire le bruit intÃ©rieur et extÃ©rieur pour entrer dans la prÃ©sence de Dieu et L'entendre parler.", verset:"Â« ArrÃªtez, et sachez que je suis Dieu ! Â»", ref:"Psaume 46,11", defi:"Accordez-vous 15 minutes de silence complet aujourd'hui. Pas de musique, pas d'Ã©cran. Juste vous et Dieu." },
  { nom:"L'ObÃ©issance", def:"RÃ©pondre Ã  la voix de Dieu avec un cÅ“ur disposÃ©, mÃªme lorsque le chemin demande un sacrifice.", verset:"Â« L'obÃ©issance vaut mieux que les sacrifices. Â»", ref:"1 Samuel 15,22", defi:"Y a-t-il quelque chose que Dieu vous demande depuis un moment ? Faites le premier pas aujourd'hui, mÃªme petit." },
  { nom:"La Tendresse", def:"Manifester un amour dÃ©licat et attentionnÃ© envers ceux qui sont fragiles, blessÃ©s ou vulnÃ©rables.", verset:"Â« Il panse leurs blessures, en bandant leurs plaies. Â»", ref:"Psaume 147,3", defi:"Approchez quelqu'un de fragile avec une tendresse particuliÃ¨re aujourd'hui. Un geste, une parole, une prÃ©sence suffit." },
  { nom:"La FidÃ©litÃ©", def:"Rester stable dans ses engagements envers Dieu et les autres, dans la durÃ©e et dans l'Ã©preuve.", verset:"Â« Celui qui est fidÃ¨le dans les petites choses l'est aussi dans les grandes. Â»", ref:"Luc 16,10", defi:"Tenez aujourd'hui un engagement que vous aviez pris, mÃªme si c'est difficile. La fidÃ©litÃ© se construit dans les petits actes." },
  { nom:"Le Recueillement", def:"Prendre le temps de rentrer en soi-mÃªme pour faire le point avec Dieu et s'aligner sur Sa volontÃ©.", verset:"Â« Lorsque tu pries, entre dans ta chambre, ferme ta porte, et prie ton PÃ¨re qui est lÃ  dans le lieu secret. Â»", ref:"Matthieu 6,6", defi:"RÃ©servez un moment de recueillement aujourd'hui, loin des distractions. Relisez votre journÃ©e avec Dieu en fin de soirÃ©e." },
  { nom:"La Sagesse", def:"Discerner la vÃ©ritÃ© de l'erreur, le bien du mal, et choisir le chemin de Dieu avec maturitÃ©.", verset:"Â« Si quelqu'un d'entre vous manque de sagesse, qu'il la demande Ã  Dieu, qui donne Ã  tous libÃ©ralement. Â»", ref:"Jacques 1,5", defi:"Avant une dÃ©cision ou un jugement, posez-vous cette question : 'Que ferait JÃ©sus Ã  ma place ?' Agissez en consÃ©quence." },
  { nom:"L'HospitalitÃ©", def:"Accueillir l'autre chez soi et dans son cÅ“ur avec chaleur, comme on accueillerait le Christ lui-mÃªme.", verset:"Â« N'oubliez pas l'hospitalitÃ©, car c'est en la pratiquant que quelques-uns ont hÃ©bergÃ© des anges sans le savoir. Â»", ref:"HÃ©breux 13,2", defi:"Accueillez quelqu'un chez vous ou invitez quelqu'un Ã  partager un moment avec vous. Ouvrez votre espace et votre cÅ“ur." },
  { nom:"La SincÃ©ritÃ©", def:"Parler et agir avec authenticitÃ©, sans masque, en harmonie parfaite entre ce qu'on pense, dit et fait.", verset:"Â« Mais que votre parole soit oui, oui, non, non ; ce qu'on dit de plus vient du malin. Â»", ref:"Matthieu 5,37", defi:"Soyez complÃ¨tement sincÃ¨re dans toutes vos interactions aujourd'hui. Aucun mensonge, aucune exagÃ©ration, aucune faÃ§ade." },
  { nom:"La Contemplation", def:"S'arrÃªter pour admirer la beautÃ© de Dieu dans Sa crÃ©ation et dans l'histoire de son peuple.", verset:"Â« Les cieux racontent la gloire de Dieu, et l'Ã©tendue des cieux proclame l'Å“uvre de ses mains. Â»", ref:"Psaume 19,2", defi:"Sortez et contemplez la crÃ©ation de Dieu pendant 10 minutes. Regardez le ciel, les arbres, la lumiÃ¨re. Adorez le CrÃ©ateur." },
  { nom:"Le DÃ©tachement", def:"Ne pas s'accrocher aux biens matÃ©riels ni aux honneurs, pour rester libre et disponible pour Dieu.", verset:"Â« Ne vous amassez pas des trÃ©sors sur la terreâ€¦ mais amassez-vous des trÃ©sors dans le ciel. Â»", ref:"Matthieu 6,19-20", defi:"Donnez ou recyclez aujourd'hui quelque chose dont vous n'avez pas besoin mais que vous gardez par attachement." },
  { nom:"L'Amour fraternel", def:"Aimer ses frÃ¨res et sÅ“urs en Christ d'un amour concret, actif et sacrificiel, sans distinction.", verset:"Â« Je vous donne un commandement nouveau : Aimez-vous les uns les autres ; comme je vous ai aimÃ©s. Â»", ref:"Jean 13,34", defi:"Faites la paix avec quelqu'un de votre communautÃ© avec qui vous avez eu une tension. Faites le premier pas." }
];

// â”€â”€ State â”€â”€
let history = [];
try { history = JSON.parse(localStorage.getItem('vertuHistory_v2') || '[]'); } catch(e) {}
let currentVertu = null;
let notifActive = false;
let notifTimer = null;

// â”€â”€ Init â”€â”€
function init() {
  // Date
  const now = new Date();
  const opts = { weekday:'long', day:'numeric', month:'long', year:'numeric' };
  document.getElementById('dateBadge').textContent = now.toLocaleDateString('fr-FR', opts).toUpperCase();

  // Stars
  const container = document.getElementById('stars');
  for (let i = 0; i < 90; i++) {
    const s = document.createElement('div');
    s.className = 'star';
    const size = Math.random() * 2.5 + 0.5;
    s.style.cssText = `width:${size}px;height:${size}px;top:${Math.random()*100}%;left:${Math.random()*100}%;--d:${(Math.random()*4+2).toFixed(1)}s;--delay:-${(Math.random()*6).toFixed(1)}s;--op:${(Math.random()*0.45+0.15).toFixed(2)};`;
    container.appendChild(s);
  }

  // CarÃªme progress (Mercredi des Cendres 2025 = 5 mars 2025, PÃ¢ques = 20 avril)
  updateCaremeProgress();

  // Notification state
  const savedNotif = localStorage.getItem('notifActive');
  if (savedNotif === 'true') {
    notifActive = true;
    document.getElementById('notifBtn').classList.add('active');
    scheduleLocalNotification();
  }

  // Service Worker
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('sw.js').catch(e => console.log('SW:', e));
  }

  renderHistory();
}

function updateCaremeProgress() {
  const careme2025Start = new Date('2025-03-05'); // Mercredi des Cendres
  const careme2025End   = new Date('2025-04-20'); // PÃ¢ques
  const now = new Date();
  const elapsed = Math.max(0, Math.floor((now - careme2025Start) / 86400000));
  const jour    = Math.min(elapsed + 1, 40);
  const restant = Math.max(0, Math.floor((careme2025End - now) / 86400000));
  const pct     = Math.min(100, Math.round(elapsed / 46 * 100));

  document.getElementById('jourNum').textContent = jour;
  document.getElementById('progressFill').style.width = pct + '%';

  // Messages d'encouragement par tranche de jours
  const MESSAGES = [
    // Jours 1â€“5 : Le dÃ©part
    { max:1,  msg:"âœ¨ Premier pas ! Le CarÃªme commence â€” soyez lumiÃ¨re dÃ¨s aujourd'hui." },
    { max:2,  msg:"ðŸŒ± Tiens bon ! Chaque grand voyage commence par un petit pas." },
    { max:3,  msg:"ðŸ’ª 3 jours dÃ©jÃ  ! Vous Ãªtes sur la bonne voie, continuez !" },
    { max:4,  msg:"ðŸ™ 4 jours de grÃ¢ce. Dieu voit vos efforts, mÃªme les plus petits." },
    { max:5,  msg:"â­ 5 jours ! Une semaine s'approche â€” vous y Ãªtes presque !" },
    // Jours 6â€“10 : La premiÃ¨re semaine
    { max:6,  msg:"ðŸŒ… Une semaine bien entamÃ©e. La rÃ©gularitÃ© est dÃ©jÃ  une victoire." },
    { max:7,  msg:"ðŸ•Šï¸ 7 jours â€” une semaine complÃ¨te ! Seigneur, merci pour cette fidÃ©litÃ©." },
    { max:8,  msg:"ðŸ”¥ 8 jours de feu ! Votre flamme ne doit pas s'Ã©teindre." },
    { max:9,  msg:"ðŸ’œ Presque 10 jours. Vous influencez autrement, continuez !" },
    { max:10, msg:"ðŸŒŸ 10 jours ! Un quart du CarÃªme accompli. Quelle belle avancÃ©e !" },
    // Jours 11â€“15 : Le premier cap
    { max:11, msg:"ðŸ”ï¸ Le chemin est long mais chaque jour compte. Ne lÃ¢chez pas !" },
    { max:12, msg:"ðŸŒ¸ 12 jours de grÃ¢ce. Le Seigneur chemine avec vous." },
    { max:13, msg:"ðŸ’¡ 13 jours ! Votre lumiÃ¨re brille de plus en plus dans le monde." },
    { max:14, msg:"âš¡ Deux semaines presque ! Vous Ãªtes un exemple pour votre entourage." },
    { max:15, msg:"ðŸ… 15 jours â€” mi-chemin approche ! Votre persÃ©vÃ©rance honore Dieu." },
    // Jours 16â€“20 : Le milieu, lÃ  oÃ¹ Ã§a devient difficile
    { max:16, msg:"ðŸ’ª Plus de la moitiÃ© s'approche ! Restez ancrÃ© dans la priÃ¨re." },
    { max:17, msg:"ðŸŒŠ Le milieu du chemin peut Ãªtre difficile. Dieu vous tient la main." },
    { max:18, msg:"ðŸ•¯ï¸ 18 jours de fidÃ©litÃ©. Chaque vertu vÃ©cue change le monde." },
    { max:19, msg:"ðŸŽ¯ Presque 20 jours ! Votre engagement est une prÃ©dication silencieuse." },
    { max:20, msg:"âš“ 20 jours ! La moitiÃ© est franchie. Restez ancrÃ©s dans le Christ !" },
    // Jours 21â€“25 : La descente vers la Semaine Sainte
    { max:21, msg:"ðŸ™Œ 21 jours ! Trois semaines de grÃ¢ce. Vous Ãªtes une inspiration." },
    { max:22, msg:"ðŸŒ¿ Le CarÃªme avance. La Semaine Sainte approche doucement." },
    { max:23, msg:"ðŸ•Šï¸ 23 jours de lumiÃ¨re portÃ©s dans le monde. C'est beau !" },
    { max:24, msg:"ðŸ’« Presque 25 jours ! Vous avez semÃ© des graines de vertu partout." },
    { max:25, msg:"ðŸŒº 25 jours ! Les 3/5 sont derriÃ¨re vous. AllÃ©luia en approche !" },
    // Jours 26â€“30 : La montÃ©e
    { max:26, msg:"â¬†ï¸ On monte vers la Semaine Sainte. Votre cÅ“ur se prÃ©pare." },
    { max:27, msg:"âœï¸ 27 jours. JÃ©sus aussi a eu des moments difficiles. Il comprend." },
    { max:28, msg:"ðŸ’œ 4 semaines rÃ©volues ! Votre fidÃ©litÃ© est un tÃ©moignage puissant." },
    { max:29, msg:"ðŸŒ„ Presque 30 jours ! Le sommet est proche, ne regardez pas en arriÃ¨re." },
    { max:30, msg:"ðŸ† 30 jours ! Vous avez tenu 30 vertus. C'est extraordinaire !" },
    // Jours 31â€“35 : La Semaine Sainte approche
    { max:31, msg:"âœ¨ La ligne d'arrivÃ©e est en vue. Restez vigilants et fervents." },
    { max:32, msg:"ðŸ”” 32 jours ! La Semaine Sainte frappe Ã  la porte." },
    { max:33, msg:"ðŸ’¡ 33 jours â€” l'Ã¢ge du Christ ! Marchez dans ses pas." },
    { max:34, msg:"ðŸŒ¹ Dimanche des Rameaux approche. PrÃ©parez votre cÅ“ur Ã  accueillir le Roi." },
    { max:35, msg:"ðŸ™ 35 jours ! Cinq jours restants. Chaque heure est prÃ©cieuse." },
    // Jours 36â€“39 : La Semaine Sainte
    { max:36, msg:"âœï¸ Semaine Sainte ! MÃ©ditez la Passion du Christ avec un cÅ“ur ouvert." },
    { max:37, msg:"ðŸ•¯ï¸ Jeudi Saint approche â€” le jour du service et de l'amour total." },
    { max:38, msg:"â¬› Vendredi Saint â€” Il a tout donnÃ© pour nous. Merci, Seigneur." },
    { max:39, msg:"ðŸŒ‘ Samedi Saint â€” Le silence avant l'explosion de la joie pascale." },
    // Jour 40 : La victoire !
    { max:40, msg:"ðŸŽ‰ JOUR 40 â€” Vous avez accompli les 40 jours ! AllÃ©luia, il est ressuscitÃ© ! âœï¸ðŸŒ…" },
  ];

  const msgObj = MESSAGES.find(m => jour <= m.max) || MESSAGES[MESSAGES.length - 1];

  if (restant > 0) {
    document.getElementById('jourRestant').textContent = `${restant} jour${restant > 1 ? 's' : ''} restant${restant > 1 ? 's' : ''}`;
  } else {
    document.getElementById('jourRestant').textContent = 'Il est ressuscitÃ© ! AllÃ©luia ! ðŸŒ…';
  }

  document.getElementById('progressMessage').textContent = msgObj.msg;
}

// â”€â”€ Draw â”€â”€
function tirerVertu() {
  document.getElementById('idleSection').style.display = 'none';
  document.getElementById('spinner').classList.add('visible');
  setTimeout(() => {
    document.getElementById('spinner').classList.remove('visible');
    // Pick avoiding last drawn
    let v;
    do { v = VERTUS[Math.floor(Math.random() * VERTUS.length)]; }
    while (currentVertu && v.nom === currentVertu.nom);
    currentVertu = v;
    afficherVertu(v);
    // Save
    const today = now().toLocaleDateString('fr-FR', {day:'numeric',month:'short'});
    history = history.filter(h => h.date !== today);
    history.unshift({ date:today, nom:v.nom });
    if (history.length > 10) history.pop();
    try { localStorage.setItem('vertuHistory_v2', JSON.stringify(history)); } catch(e) {}
    renderHistory();
  }, 950);
}

function now() { return new Date(); }

function afficherVertu(v) {
  document.getElementById('vertuName').textContent = v.nom;
  document.getElementById('vertuDef').textContent = v.def;
  document.getElementById('versetText').textContent = v.verset;
  document.getElementById('versetRef').textContent = v.ref;
  document.getElementById('defiText').textContent = v.defi;
  document.getElementById('resultSection').classList.add('visible');
}

function nouvelleVertu() {
  document.getElementById('resultSection').classList.remove('visible');
  document.getElementById('spinner').classList.add('visible');
  setTimeout(() => {
    document.getElementById('spinner').classList.remove('visible');
    let v;
    do { v = VERTUS[Math.floor(Math.random() * VERTUS.length)]; }
    while (currentVertu && v.nom === currentVertu.nom);
    currentVertu = v;
    afficherVertu(v);
  }, 750);
}

// â”€â”€ History â”€â”€
function renderHistory() {
  if (!history.length) return;
  document.getElementById('historySection').style.display = 'block';
  document.getElementById('historyList').innerHTML = history.map(h => `
    <div class="history-item">
      <span class="history-date">${h.date}</span>
      <span class="history-dot"></span>
      <span class="history-name">${h.nom}</span>
    </div>`).join('');
}

// â”€â”€ Notifications â”€â”€
function openNotifModal() {
  document.getElementById('notifModal').classList.add('open');
  document.getElementById('notifStatus').textContent = '';
}
function closeNotifModal() {
  document.getElementById('notifModal').classList.remove('open');
}

async function activerNotifications() {
  const statusEl = document.getElementById('notifStatus');

  if (!('Notification' in window)) {
    statusEl.textContent = 'âš ï¸ Votre navigateur ne supporte pas les notifications.';
    return;
  }

  const permission = await Notification.requestPermission();
  if (permission !== 'granted') {
    statusEl.textContent = 'âš ï¸ Veuillez autoriser les notifications dans votre navigateur.';
    return;
  }

  const hour   = parseInt(document.getElementById('notifHour').value);
  const minute = parseInt(document.getElementById('notifMinute').value);

  localStorage.setItem('notifActive', 'true');
  localStorage.setItem('notifHour', hour);
  localStorage.setItem('notifMinute', minute);

  notifActive = true;
  document.getElementById('notifBtn').classList.add('active');
  scheduleLocalNotification();

  statusEl.textContent = `âœ¦ Rappel activÃ© chaque jour Ã  ${String(hour).padStart(2,'0')}h${String(minute).padStart(2,'0')} !`;
  setTimeout(() => closeNotifModal(), 2200);
}

function scheduleLocalNotification() {
  if (notifTimer) clearTimeout(notifTimer);
  const hour   = parseInt(localStorage.getItem('notifHour')   || '8');
  const minute = parseInt(localStorage.getItem('notifMinute') || '0');

  const now2 = new Date();
  const target = new Date();
  target.setHours(hour, minute, 0, 0);
  if (target <= now2) target.setDate(target.getDate() + 1); // tomorrow

  const delay = target - now2;
  notifTimer = setTimeout(() => {
    fireNotification();
    // reschedule daily
    notifTimer = setInterval(fireNotification, 24 * 60 * 60 * 1000);
  }, delay);
}

function fireNotification() {
  if (Notification.permission !== 'granted') return;
  const random = VERTUS[Math.floor(Math.random() * VERTUS.length)];
  new Notification('âœ¦ Ma Vertu du Jour âœ¦', {
    body: `Aujourd'hui : ${random.nom}\n"${random.def.substring(0,80)}â€¦"\n\nInfluencons Autrement ðŸ•Šï¸`,
    icon: 'icons/icon-192.png',
    badge: 'icons/icon-192.png',
    tag: 'vertu-quotidienne'
  });
}

// â”€â”€ Share â”€â”€
function getShareText() {
  if (!currentVertu) return '';
  return `âœ¦ Ma Vertu du Jour âœ¦\n\n${currentVertu.nom}\n\n${currentVertu.verset}\n${currentVertu.ref}\n\nðŸŒ influencons.com â€” Influencons Autrement`;
}
function partager(reseau) {
  const text = encodeURIComponent(getShareText());
  const url  = encodeURIComponent('https://influencons.com');
  if (reseau === 'facebook') window.open(`https://www.facebook.com/sharer/sharer.php?u=${url}&quote=${text}`, '_blank');
  else if (reseau === 'whatsapp') window.open(`https://wa.me/?text=${text}%20${url}`, '_blank');
}
function copier() {
  navigator.clipboard.writeText(getShareText() + '\nhttps://influencons.com').then(() => {
    showToast('âœ¦ CopiÃ© dans le presse-papier !');
    const btn = document.getElementById('btnCopier');
    const orig = btn.innerHTML;
    btn.innerHTML = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" style="width:13px;height:13px"><polyline points="20 6 9 17 4 12"/></svg> CopiÃ© !`;
    setTimeout(() => btn.innerHTML = orig, 2200);
  });
}

// â”€â”€ Toast â”€â”€
function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 2500);
}

init();
</script>
</body>
</html>
